<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SŌMA - Registre Professionnel</title>
    <style>
        :root {
            --header-bg: #E1E3E3;
            --accent: #2d3436;
            --paper-pattern: none;
        }

        body { 
            font-family: 'Inter', -apple-system, sans-serif; 
            background-color: #f0f0f0; 
            margin: 0; padding: 0;
            overflow-x: hidden;
        }

        .grain {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999; opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* --- COUVERTURE --- */
        #cover {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--header-bg); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            padding: 60px 20px; box-sizing: border-box;
            transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: left center;
            box-shadow: inset -5px 0 10px rgba(0,0,0,0.1), 10px 0 30px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        #cover.opened { transform: rotateY(-115deg); pointer-events: none; }

        .turn-page-hint { 
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%); 
            writing-mode: vertical-rl; text-transform: uppercase; font-size: 10px; 
            letter-spacing: 2px; opacity: 0.5; 
        }

        /* --- PAGE INTÉRIEURE (MODIFIÉE) --- */
        #main-content { 
            padding: 40px 20px; min-height: 100vh; 
            background-color: #ffffff;
            background-image: var(--paper-pattern);
            opacity: 0; transition: opacity 0.5s; 
        }
        .visible { opacity: 1 !important; }

        /* Styles des papiers d'inspiration */
        .paper-grid { background-image: radial-gradient(#d1d1d1 1px, transparent 1px); background-size: 20px 20px; }
        .paper-lines { background-image: linear-gradient(#e5e5e5 1px, transparent 1px); background-size: 100% 30px; }

        .top-menu { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: white; padding: 10px; border-radius: 8px; }

        .icon-btn { cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .rainbow-bar { width: 24px; height: 4px; border-radius: 2px; background: linear-gradient(to right, #ff9f43, #feca57, #1dd1a1, #48dbfb, #54a0ff); }

        /* --- MODALES --- */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 20px; border-radius: 15px; z-index: 10001;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); width: 350px;
        }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 10000; }
        
        .palette-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 1px solid #eee; }

        /* --- TABLEAU --- */
        .table-container { background: rgba(255,255,255,0.8); backdrop-filter: blur(5px); border-radius: 12px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        thead { background-color: var(--header-bg); }
        th { padding: 15px; text-align: left; font-size: 11px; text-transform: uppercase; }
        
        .stage-period { margin: 20px 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .stage-period input { border: none; border-bottom: 1px solid #ccc; background: transparent; padding: 5px; font-family: inherit; }

    </style>
</head>
<body id="mainBody">

    <div class="grain"></div>
    <div id="overlay" onclick="closeAllModals()"></div>

    <div id="colorModal" class="modal">
        <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">Teinte du Registre</p>
        <div class="palette-grid" id="paletteGrid"></div>
    </div>

    <div id="paperModal" class="modal">
        <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">Texture du Papier</p>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button onclick="setPaper('none')" style="flex:1; padding:10px;">Uni</button>
            <button onclick="setPaper('paper-grid')" style="flex:1; padding:10px;">Petit Carreaux</button>
            <button onclick="setPaper('paper-lines')" style="flex:1; padding:10px;">Ligné</button>
        </div>
    </div>

    <div id="book-wrapper">
        <div id="cover" onclick="openBook()">
            <div style="font-size: 32px; letter-spacing: 8px; font-weight: 300; text-transform: uppercase; margin-top: 10vh;">Suivi de candidature</div>
            <div class="user-info" onclick="event.stopPropagation()">
                <input type="text" id="userName" placeholder="PRÉNOM ET NOM" style="border:none; border-bottom:1px solid #000; background:transparent; text-align:center; width:250px; font-size:16px;">
            </div>
            <div class="turn-page-hint">Tourner la page →</div>
            <div style="font-size: 24px; letter-spacing: 5px; font-weight: 400;">SŌMA</div>
        </div>

        <div id="main-content">
            <div class="top-menu">
                <button onclick="closeBook()" style="background:none; border:1px solid #000; padding:5px 10px; cursor:pointer; font-size:10px; text-transform:uppercase;">Refermer</button>
                
                <div style="display: flex; gap: 20px;">
                    <div class="icon-btn" onclick="openModal('paperModal')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                        <div style="font-size:8px; margin-top:2px;">PAPIER</div>
                    </div>
                    <div class="icon-btn" onclick="openModal('colorModal')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19l7-7 3 3-7 7-3-3zM18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path></svg>
                        <div class="rainbow-bar"></div>
                    </div>
                </div>
            </div>

            <div style="border-bottom: 1px solid #eee; margin-bottom: 20px;">
                <h1 style="font-weight: 300; text-transform: uppercase; letter-spacing: 3px;">Registre de Prospection</h1>
            </div>

            <div class="stage-period">
                Période de stage : du <input type="month" id="stageStart"> au <input type="month" id="stageEnd">
            </div>

            <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                <div style="background:white; padding:15px; border-radius:10px; flex:1; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <span id="totalCount" style="font-size:20px; font-weight:bold;">0</span><br><small>ENVOIS</small>
                </div>
                <div style="background:white; padding:15px; border-radius:10px; flex:1; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                    <span id="relanceCount" style="font-size:20px; font-weight:bold; color:#e74c3c">0</span><br><small>RELANCES</small>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Établissement</th>
                            <th>Lieu / Adresse</th>
                            <th>Date d'envoi</th>
                            <th>Relance (J+10)</th>
                            <th>Statut</th>
                            <th>Réponse</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <button onclick="addRow()" style="margin-top:20px; padding:10px 20px; background:#000; color:#fff; border:none; border-radius:5px; cursor:pointer; font-size:11px; text-transform:uppercase;">+ Ajouter une prospection</button>
        </div>
    </div>

    <script>
        // Codes des 40 couleurs pastel de la photo
        const pastelColors = [
            "#E1E3E3", "#DFD8D5", "#D8D5D2", "#E6D4C4", "#BAB1B0", "#898684", "#F2F8F8", "#C3CED1", "#B1A6A6", "#B0AEB4",
            "#A2A09A", "#6F6869", "#E8E7E7", "#EEE9E9", "#D5C7B3", "#E2D7D4", "#B0A19F", "#C09D89", "#D0CFCD", "#E9F0F0",
            "#E4DDD4", "#B1B6AF", "#D7D8D2", "#B6AD9E", "#DFE5E5", "#E4E9EC", "#B8BFBA", "#8F877F", "#859A9E", "#BDD2E0",
            "#F8FCFD", "#E9EDEE", "#CFCFD4", "#E2DFD7", "#E2D5D5", "#DED0C7", "#F6F2F0", "#D4C1BA", "#D0C9CB", "#C1B2B1"
        ];

        let candidatures = JSON.parse(localStorage.getItem('soma_v8')) || [];

        function openBook() { 
            document.getElementById('cover').classList.add('opened'); 
            document.getElementById('main-content').classList.add('visible');
        }
        function closeBook() { 
            document.getElementById('cover').classList.remove('opened'); 
            document.getElementById('main-content').classList.remove('visible');
        }

        function openModal(id) {
            document.getElementById(id).style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            document.getElementById('overlay').style.display = 'none';
        }

        function setPaper(type) {
            document.getElementById('main-content').className = type + ' visible';
            localStorage.setItem('soma_paper', type);
            closeAllModals();
        }

        const grid = document.getElementById('paletteGrid');
        pastelColors.forEach(color => {
            const dot = document.createElement('div');
            dot.className = 'color-dot';
            dot.style.background = color;
            dot.onclick = () => {
                document.documentElement.style.setProperty('--header-bg', color);
                localStorage.setItem('soma_theme_color', color);
                closeAllModals();
            };
            grid.appendChild(dot);
        });

        function addRow() {
            candidatures.push({ id: Date.now(), nom: "", lieu: "", date: "", reponse: "Attente" });
            render();
        }

        function render() {
            const body = document.getElementById('tableBody');
            body.innerHTML = "";
            let relNb = 0;
            candidatures.forEach((c, i) => {
                const relDate = calculateRelance(c.date);
                const isLate = checkLate(relDate) && c.reponse === "Attente";
                if(isLate) relNb++;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${c.nom}" oninput="update(${i}, 'nom', this.value)" placeholder="Nom..."></td>
                    <td><input type="text" value="${c.lieu}" oninput="update(${i}, 'lieu', this.value)" placeholder="Ville..."></td>
                    <td><input type="date" value="${c.date}" onchange="update(${i}, 'date', this.value)"></td>
                    <td>${relDate}</td>
                    <td style="color:${isLate ? '#e74c3c' : 'inherit'}">${isLate ? 'À RELANCER' : 'OK'}</td>
                    <td>
                        <select onchange="update(${i}, 'reponse', this.value)">
                            <option value="Attente" ${c.reponse==='Attente'?'selected':''}>Attente</option>
                            <option value="Oui" ${c.reponse==='Oui'?'selected':''}>OUI</option>
                            <option value="Non" ${c.reponse==='Non'?'selected':''}>NON</option>
                        </select>
                    </td>
                `;
                body.appendChild(row);
            });
            document.getElementById('totalCount').innerText = candidatures.length;
            document.getElementById('relanceCount').innerText = relNb;
        }

        function update(i, k, v) { 
            candidatures[i][k] = v; 
            localStorage.setItem('soma_v8', JSON.stringify(candidatures));
        }

        function calculateRelance(d) {
            if(!d) return "-";
            let date = new Date(d);
            date.setDate(date.getDate() + 10);
            return date.toLocaleDateString('fr-FR');
        }

        function checkLate(dateStr) {
            if(dateStr === "-") return false;
            const p = dateStr.split('/');
            return new Date() > new Date(p[2], p[1]-1, p[0]);
        }

        // Init
        const savedPaper = localStorage.getItem('soma_paper');
        if(savedPaper) setPaper(savedPaper);
        const savedColor = localStorage.getItem('soma_theme_color');
        if(savedColor) document.documentElement.style.setProperty('--header-bg', savedColor);
        render();
    </script>
</body>
</html>
