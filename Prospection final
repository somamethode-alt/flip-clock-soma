<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SŌMA - Registre Professionnel</title>
    <style>
        :root {
            --header-bg: #E1E3E3;
            --accent: #2d3436;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0f0f0; 
            margin: 0; padding: 0;
            overflow-x: hidden;
        }

        /* --- TEXTURES DE PAPIER (CSS pur pour netteté) --- */
        .paper-uni { background-color: #ffffff; background-image: none; }
        
        .paper-grid { 
            background-color: #ffffff;
            background-image: radial-gradient(#d1d1d1 0.8px, transparent 0.8px);
            background-size: 20px 20px; 
        }
        
        .paper-lines { 
            background-color: #ffffff;
            background-image: linear-gradient(#e5e5e5 1px, transparent 1px);
            background-size: 100% 30px; 
        }

        /* --- GRAIN ET EFFETS --- */
        .grain {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999; opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* --- COUVERTURE --- */
        #cover {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--header-bg); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            padding: 60px 20px; box-sizing: border-box;
            transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: left center;
            box-shadow: inset -5px 0 10px rgba(0,0,0,0.1), 10px 0 30px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        #cover.opened { transform: rotateY(-115deg); pointer-events: none; }

        .turn-page-hint { 
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%); 
            writing-mode: vertical-rl; text-transform: uppercase; font-size: 10px; 
            letter-spacing: 2px; opacity: 0.5; 
        }

        /* --- PAGE INTÉRIEURE --- */
        #main-content { 
            padding: 40px 20px; min-height: 100vh; 
            opacity: 0; transition: opacity 0.5s; 
            position: relative;
        }
        .visible { opacity: 1 !important; }

        .top-menu { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: relative; z-index: 10; }

        /* --- MODALES --- */
        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 25px; border-radius: 20px; z-index: 10001;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15); width: 320px;
        }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.2); z-index: 10000; backdrop-filter: blur(2px); }
        
        /* Grille couleurs */
        .palette-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 1px solid #eee; }

        /* Visuels Papiers (Aperçus dans la modale) */
        .paper-preview {
            display: flex; flex-direction: column; gap: 15px; margin-top: 15px;
        }
        .paper-opt {
            height: 60px; border-radius: 10px; border: 1px solid #eee; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 11px;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.2s;
        }
        .paper-opt:hover { border-color: #000; }

        /* --- COPYRIGHT --- */
        .copyright {
            text-align: center; font-size: 10px; color: #999; margin-top: 50px;
            letter-spacing: 2px; text-transform: uppercase;
        }

        /* --- TABLEAU --- */
        .table-container { background: rgba(255,255,255,0.7); backdrop-filter: blur(10px); border-radius: 15px; overflow-x: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        thead { background-color: var(--header-bg); }
        th { padding: 15px; text-align: left; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 12px 15px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        input { border: none; background: transparent; font-family: inherit; width: 100%; }

    </style>
</head>
<body class="paper-uni">

    <div class="grain"></div>
    <div id="overlay" onclick="closeAllModals()"></div>

    <div id="colorModal" class="modal">
        <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px;">Teinte du Registre</p>
        <div class="palette-grid" id="paletteGrid"></div>
    </div>

    <div id="paperModal" class="modal">
        <p style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px;">Texture du Papier</p>
        <div class="paper-preview">
            <div class="paper-opt paper-uni" onclick="setPaper('paper-uni')">Uni Minimaliste</div>
            <div class="paper-opt paper-grid" onclick="setPaper('paper-grid')">Petit Carreaux</div>
            <div class="paper-opt paper-lines" onclick="setPaper('paper-lines')">Ligné Classique</div>
        </div>
    </div>

    <div id="book-wrapper">
        <div id="cover" onclick="openBook()">
            <div style="font-size: 32px; letter-spacing: 8px; font-weight: 300; text-transform: uppercase; margin-top: 10vh; text-align: center;">Suivi de candidature</div>
            <div class="user-info" onclick="event.stopPropagation()">
                <input type="text" id="userName" placeholder="PRÉNOM ET NOM" style="border-bottom: 1px solid #000; text-align: center; padding: 10px; font-size: 16px;">
            </div>
            <div class="turn-page-hint">Tourner la page →</div>
            <div style="font-size: 24px; letter-spacing: 5px; font-weight: 400;">SŌMA</div>
        </div>

        <div id="main-content">
            <div class="top-menu">
                <button onclick="closeBook()" style="background:none; border:1px solid #000; padding:8px 15px; cursor:pointer; font-size:10px; text-transform:uppercase; border-radius:20px;">Refermer le registre</button>
                
                <div style="display: flex; gap: 20px;">
                    <div style="cursor:pointer; text-align:center" onclick="openModal('paperModal')">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        <div style="font-size:8px; margin-top:2px; font-weight:bold">PAPIER</div>
                    </div>
                    <div style="cursor:pointer; text-align:center" onclick="openModal('colorModal')">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="1.5"><path d="M12 19l7-7 3 3-7 7-3-3zM18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path></svg>
                        <div style="width:22px; height:3px; background:linear-gradient(to right, #ff9f43, #1dd1a1, #54a0ff); margin:2px auto 0; border-radius:2px;"></div>
                    </div>
                </div>
            </div>

            <h2 style="font-weight: 300; text-transform: uppercase; letter-spacing: 4px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Registre de Prospection</h2>

            <div style="margin: 20px 0; font-size: 13px; letter-spacing: 1px;">
                PÉRIODE DE STAGE : DU <input type="month" id="s1" style="width:140px; border-bottom:1px solid #ccc"> AU <input type="month" id="s2" style="width:140px; border-bottom:1px solid #ccc">
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Établissement</th>
                            <th>Adresse / Ville</th>
                            <th>Date d'envoi</th>
                            <th>Relance (J+10)</th>
                            <th>Réponse</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>

            <button onclick="addRow()" style="margin-top:20px; padding:12px 25px; background:#000; color:#fff; border:none; border-radius:30px; cursor:pointer; font-size:10px; text-transform:uppercase; letter-spacing:1px;">+ Nouvelle Ligne</button>

            <div class="copyright">Copyright Sōma © 2024</div>
        </div>
    </div>

    <script>
        // Palette des 40 couleurs
        const pastelColors = ["#E1E3E3", "#DFD8D5", "#D8D5D2", "#E6D4C4", "#BAB1B0", "#898684", "#F2F8F8", "#C3CED1", "#B1A6A6", "#B0AEB4", "#A2A09A", "#6F6869", "#E8E7E7", "#EEE9E9", "#D5C7B3", "#E2D7D4", "#B0A19F", "#C09D89", "#D0CFCD", "#E9F0F0", "#E4DDD4", "#B1B6AF", "#D7D8D2", "#B6AD9E", "#DFE5E5", "#E4E9EC", "#B8BFBA", "#8F877F", "#859A9E", "#BDD2E0", "#F8FCFD", "#E9EDEE", "#CFCFD4", "#E2DFD7", "#E2D5D5", "#DED0C7", "#F6F2F0", "#D4C1BA", "#D0C9CB", "#C1B2B1"];

        let candidatures = JSON.parse(localStorage.getItem('soma_final')) || [];

        function openBook() { 
            document.getElementById('cover').classList.add('opened'); 
            document.getElementById('main-content').classList.add('visible');
        }
        function closeBook() { 
            document.getElementById('cover').classList.remove('opened'); 
            document.getElementById('main-content').classList.remove('visible');
        }

        function openModal(id) {
            document.getElementById(id).style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            document.getElementById('overlay').style.display = 'none';
        }

        // CORRECTION : Changement de fond appliqué au BODY pour couvrir toute la page
        function setPaper(type) {
            document.body.className = type;
            localStorage.setItem('soma_paper_type', type);
            closeAllModals();
        }

        const grid = document.getElementById('paletteGrid');
        pastelColors.forEach(color => {
            const dot = document.createElement('div');
            dot.className = 'color-dot';
            dot.style.background = color;
            dot.onclick = () => {
                document.documentElement.style.setProperty('--header-bg', color);
                localStorage.setItem('soma_theme_final', color);
                closeAllModals();
            };
            grid.appendChild(dot);
        });

        function addRow() {
            candidatures.push({ id: Date.now(), nom: "", lieu: "", date: "", reponse: "Attente" });
            render();
        }

        function render() {
            const body = document.getElementById('tableBody');
            body.innerHTML = "";
            candidatures.forEach((c, i) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${c.nom}" oninput="update(${i}, 'nom', this.value)" placeholder="..."></td>
                    <td><input type="text" value="${c.lieu}" oninput="update(${i}, 'lieu', this.value)" placeholder="..."></td>
                    <td><input type="date" value="${c.date}" onchange="update(${i}, 'date', this.value)"></td>
                    <td>${calculateRelance(c.date)}</td>
                    <td>
                        <select onchange="update(${i}, 'reponse', this.value)" style="border:none; background:transparent; font-family:inherit;">
                            <option value="Attente" ${c.reponse==='Attente'?'selected':''}>Attente</option>
                            <option value="Oui" ${c.reponse==='Oui'?'selected':''}>OUI</option>
                            <option value="Non" ${c.reponse==='Non'?'selected':''}>NON</option>
                        </select>
                    </td>
                `;
                body.appendChild(row);
            });
        }

        function update(i, k, v) { 
            candidatures[i][k] = v; 
            localStorage.setItem('soma_final', JSON.stringify(candidatures));
        }

        function calculateRelance(d) {
            if(!d) return "-";
            let date = new Date(d);
            date.setDate(date.getDate() + 10);
            return date.toLocaleDateString('fr-FR');
        }

        // Chargement des préférences
        const savedPaper = localStorage.getItem('soma_paper_type');
        if(savedPaper) setPaper(savedPaper);
        const savedColor = localStorage.getItem('soma_theme_final');
        if(savedColor) document.documentElement.style.setProperty('--header-bg', savedColor);
        render();
    </script>
</body>
</html>
